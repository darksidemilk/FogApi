name: Test Build

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
    build:
        runs-on: windows-latest
    
        steps:
        - uses: actions/checkout@v4

        - name: Run build script
          run: |
            install-module PlatyPS -requiredversion 0.14.2
            .\build.ps1
            if (Test-Modulemanifest -path "$Home\ModuleBuild\$moduleName\$moduleName.psd1") {
                if (import-module "$Home\ModuleBuild\$moduleName") {
                    "Built module imported successfully!"
                    return $true;
                } else {
                    Write-Error "Failed to import module!"
                    return $false;
                }
            } else {
                Write-Error "Manifest threw error"
                return $false;
            }